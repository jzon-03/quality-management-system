<mat-card class="form-card">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>{{ isEditMode ? 'edit' : 'add_circle' }}</mat-icon>
      {{ isEditMode ? 'Edit Inspection Record' : 'Create New Inspection Record' }}
    </mat-card-title>
  </mat-card-header>
  
  <mat-card-content>
    <form [formGroup]="ipiForm" (ngSubmit)="onSubmit()">
      <!-- Tab Navigation -->
      <mat-tab-group [(selectedIndex)]="activeTabIndex" class="ipi-tabs">
        <!-- Basic Information Tab -->
        <mat-tab label="Basic Info">
          <app-ipi-basic-info 
            [formGroup]="ipiForm"
            [workCenters]="workCenters"
            [shifts]="shifts"
            [priorities]="priorities"
            [statuses]="statuses">
          </app-ipi-basic-info>
        </mat-tab>

        <!-- Quantities Tab -->
        <mat-tab label="Quantities">
          <app-ipi-quantities 
            [formGroup]="ipiForm"
            [dispositions]="dispositions">
          </app-ipi-quantities>
        </mat-tab>

        <!-- Defects Tab -->
        <mat-tab label="Defects">
          <app-ipi-defects 
            [formGroup]="ipiForm"
            [defectTypes]="defectTypes"
            [severities]="severities"
            (addDefect)="onAddDefect()"
            (removeDefect)="onRemoveDefect($event)">
          </app-ipi-defects>
        </mat-tab>

        <!-- Measurements Tab -->
        <mat-tab label="Measurements">
          <app-ipi-measurements 
            [formGroup]="ipiForm"
            [measurementUnits]="measurementUnits"
            [results]="results"
            (addMeasurement)="onAddMeasurement()"
            (removeMeasurement)="onRemoveMeasurement($event)">
          </app-ipi-measurements>
        </mat-tab>

        <!-- Visual Checks Tab -->
        <mat-tab label="Visual Checks">
          <app-ipi-visual-checks 
            [formGroup]="ipiForm"
            [results]="results"
            (addVisualCheck)="onAddVisualCheck()"
            (removeVisualCheck)="onRemoveVisualCheck($event)">
          </app-ipi-visual-checks>
        </mat-tab>

        <!-- Process Parameters Tab -->
        <mat-tab label="Process Parameters">
          <app-ipi-process-parameters 
            [formGroup]="ipiForm"
            [processResults]="processResults"
            (addProcessParameter)="onAddProcessParameter()"
            (removeProcessParameter)="onRemoveProcessParameter($event)">
          </app-ipi-process-parameters>
        </mat-tab>

        <!-- Summary Tab -->
        <mat-tab label="Summary">
          <app-ipi-summary [formGroup]="ipiForm"></app-ipi-summary>
        </mat-tab>
      </mat-tab-group>

      <mat-card-actions align="end">
        <button mat-button type="button" (click)="onResetForm()">
          <mat-icon>cancel</mat-icon>
          Cancel
        </button>
        <button mat-raised-button color="primary" type="submit" [disabled]="!ipiForm.valid">
          <mat-icon>{{ isEditMode ? 'update' : 'save' }}</mat-icon>
          {{ isEditMode ? 'Update Inspection' : 'Submit Inspection' }}
        </button>
      </mat-card-actions>
    </form>
  </mat-card-content>
</mat-card>
